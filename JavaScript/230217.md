# JavaScript는 브라우저에서 어떻게 작동할까?

## 📌 코드가 분석(Parsing) 되고 컴파일링되는 방법

브라우저 엔진마다 조금씩 다를 수 있지만 대부분 브라우저의 엔진은 두 부분으로 나뉜다. `인터프리터(Interpreter)`와 `컴파일러(Compiler)`로 나뉜다.

### `인터프리터`

- 인터프리터는 코드를 한 줄씩 읽고 즉시 실행한다.
- 구문 오류나 런타임 오류가 있는 경우 인터프리터가 프로그램을 중지하고 오류 메세지를 표시한다.

### `컴파일러`

- 컴파일러는 전체 코드를 읽고 이 코드를 기계가 실행할 수 있는 수준의 언어로 변환하는 역할을 한다.
- 이를 통해 실행 속도가 빨라지고, 코드가 더 효율적으로 실행되도록 최적화할 수 있다.
- 컴파일 된 코드는 인터프리터에 의해 실행될 수 있다.

> - Modern JavaScript 엔진에서 인터프리터는 처음에 코드를 실행하는 데 사용되고, 컴파일러는 코드가 실행될 때 같이 최적화한다. 이런 방법을 `JiT(Just-in-Time)` 컴파일이라고 한다. 컴파일러는 자주 실행되는 코드 부분을 가져와 최적화해서 코드 실행 속도를 높인다.
> - JavaScript 엔진에는 `메모리 힙(Heap)`과 `호출 스택(Call Stack)`도 포함되어 있다. 메모리 힙은 객체들과 변수가 저장되는 곳이고, 호출 스택은 함수 호출과 실행 컨텍스트를 추적하는 데 사용된다.

## 📌 코드는 어떻게 실행될까?

<img src="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop/the_javascript_runtime_environment_example.svg">

[출처: MDN | The event loop](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)

### `Heap`

- 객체 및 기타 데이터를 저장하는 데 사용되는 큰 메모리 풀이다.(장기 메모리 구조)
- JavaScript 실행 중에 생성되고, 필요에 따라 동적으로 할당되며 객체는 `new` 키워드를 사용해서 생성할 때 Heap에 추가된다.
- 더 이상 사용되지 않는 메모리를 자동으로 해제하는 JavaScript 엔진의 `garbage collector`에 의해 관리된다.

### `Stack`

- 현재 실행중인 프로그램 실행 컨텍스트를 추적하는 데이터 구조다.(단기 데이터 구조)
- JavaScript 엔진이 프로그램이 실행되는 위치를 추적하는 방법이다.
- 함수가 호출될 때마다 엔진은 해당 함수에 대한 새 실행 컨텍스트를 생성하고 맨 위에 푸시한다.
- 실행 컨텍스트에는 함수의 인자, 지역 변수 및 반환 정보 등이 포함된다.
- 현재 Stack의 맨 위에 있는 함수가 현재 실행 중인 함수다. 이 함수의 실행이 완료되면 실행 컨텍스트가 Stack에서 제거되고 엔진이 Stack의 다음 함수로 이동한다.
- Call Stack이 너무 커지면 `스택 오버플로(Stack Overflow)`가 발생할 수 있다.(무한 루프, 함수가 종료되지 않고 재귀적으로 호출되는 경우)

> JavaScript 엔진은 Heap과 Stack을 사용해서 메모리를 관리하고 코드를 실행한다.
> Stack에서 현재 실행 컨텍스트를 추적하고 Heap에서 메모리를 할당 및 할당 해제하면서 엔진은 JavaScript 코드를 효율적으로 실행할 수 있다.

### `Event Loop`

- JavaScript가 동시성을 관리하는 방법의 핵심 개념이다.
- 특정 조건이 충족되면 이벤트를 처리하고 코드를 실행하는 역할을 한다.
- 메세지 대기열에서 새 이벤트를 지속적으로 확인한다.
- 이벤트가 메시지 대기열에 추가되면 이벤트 루프는 Call Stack이 비어 있는지 확인 후 비어 있다면 이벤트가 대기열에서 제거되고 실행된다. Call Stack이 비어 있지 않으면 비워질 때까지 이벤트가 대기한다.

> JavaScript는 단일 스레드 언어이기 때문에 한 번에 하나의 작업만 실행할 수 있다. 오래 실행되는 작업이 있는 경우 해당 작업이 완료될 때까지 브라우저가 정지된 것처럼 보일 수 있다. 이를 방지하기 위해서 JavaScript는 이벤트 루프를 사용해서 작업을 관리하고 브라우저가 응답 상태를 유지하게 한다.
